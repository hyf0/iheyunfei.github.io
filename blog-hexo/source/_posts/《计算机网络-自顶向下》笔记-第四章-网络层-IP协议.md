---
title: 《计算机网络-自顶向下》笔记-第四章-网络层-IP协议
date: 2019-06-05 20:39:52
tags:
- 计算机网络
- 读书笔记
---

对于互联网的网络层来说，其提供的服务非常简单：
- 转发
- 路由选择

## 网络层可能提供的服务

网络服务模型：
- 确保交付
- 保证延迟的确保交付
- 有序交付
- 确保最小带宽
- 确保最大时延抖动
- 安全性服务

那么IP协议提供以上那些服务呢？

答案就是：**一个也不提供**

- **不** 确保交付
- **不** 保证延迟的确保交付
- **不** 有序交付
- **不** 确保最小带宽
- **不** 确保最大时延抖动
- **没有** 安全性服务

## 数据报网络

IP协议构建的网络就属于数据报网络

特点：
- 无需建立连接，维持状态信息
- 使用转发表决定分组输出端口
- 通过最长前缀匹配原则进行查询转发表

## 路由器工作原理

- 输入端口 - 从物理层接收数据，拆封分组、查看相应协议层头部，查询转发表放进发送队列
- 交换结构 - 负责发送队列到输出队列的运输
- 输出端口 - 拿到输出队列的数据，然后封上相应协议层的头部，送给物理层
- 路由选择处理器 - 负责执行路由选择，更新转发表，以及一些控制功能

## 网络层的三个主要组件

### IP协议

#### IPV4数据报格式

- 版本：规定了IP协议版本
- 首部长度
- 服务类型：区分不同类型的IP数据报
- 数据报长度
- 标识、标志、片偏移：用于IP数据报分片
- 寿命：一个数据报可以被路由处理的次数
- 协议：用于IP的多路复用和分解，即应将数据交付给上层的那个协议，TCP还是UDP。
- 首部检验和
- 源和目的IP地址
- 选项：用于扩展IP首部
- 数据

#### IPV4编址

- 总长度为32位
- 一般以8位一组
- 子网：具有相同的前半部分地址的一组IP地址构成的网络
- 编址方案：
    - 无类别域间路由选择
    - 分类编址

#### DHCP

是一种用于自动分配IP地址且即插即用的协议，使用UDP作为输运层服务

对于一个新加入网络的电脑：
1. DHCP服务器发现。通过设置源ip地址为0.0.0.0，且目的ip地址为255.255.255.255的UDP分组，在网络中广播
2. DHCP服务器提供。DHCP监听到广播，使用一个 **DHCP提供报文** 向客户作出响应(继续以广播的形式发出，因为此时客户依旧没有自己的IP地址)
3. DHCP请求。客户得到响应后，发送一个 **DHCP请求报文**，回显响应的配置参数
4. DHCP ACK。服务器回应一个 **DHCP ACK报文**，响应客户的请求报文

#### NAT

从目的来说，NAT技术使得多台电脑可以通过一个公共ip上网，且不发生冲突。

其行文的核心在于，从路由器(具备公共IP的设备)拦截所有的分组，修改其ip地址和端口，并记录这种修改产生相应的映射，发送修改后的分组，接收时执行相反的步骤。

### 路由选择算法

路由选择的功能是更新路由器中的路由表(转发表)

#### 分类

全局还是分散：
- 全局式路由选择算法(链路状态算法)：
    - 需要事先知道网络总体的分布图
- 分散式路由选择算法(距离向量算法)：
    - 无需知道网络总体的分布图

动态还是静态：
- 静态路由选择
- 动态路由选择

是否负载敏感：
- 负载敏感算法
- 负载迟钝算法

### 因特网控制报文协议(ICMP)

- 用于主机和路由器彼此沟通信息
- 构建于IP协议之上(因为其报文位于为IP数据报的数据字段)





